<!DOCTYPE html>
<html>

	<head>

		<meta charset="utf-8"> 
		<title>Does MrDoob Approves?</title>

	</head>

<body>
	<style>
		body {
			font-family: "Helvetica Neue", Helvetica, sans-serif;
			padding: 0.5em;
		}

		textarea {
			font-size: 1em;
			display: block;
			width: 100%;
			height: 20em;
			padding: 0.5em;
			font-family: monospace;
			font-size: 18px;
		}

		h1 {
			font-weight: 300;
			font-size: 4em;
			margin: 0.1em;
		}

		button {
			padding: 0.5em;
			margin-top: 0.5em;
			font-size: 1em;
		}

		pre {

		}

		span {

		}

		#answer {
			transition: opacity 2s ease-out;
			opacity: 0;
		}

		.yes {
			color: green;
		}

		.no {
			color: red;
		}

		.maybe {
			color: orange;
		}
		
		.show {
			display: block;
		}
		
		.hide {
			display: none;
		}

		a {
			/*text-decoration: none;*/
		}

		a:hover {
			/*text-decoration: underline;*/
			text-decoration: none;
			font-weight: bolder;
		}

	</style>


	<h1>Is your code style approved by <a href="https://twitter.com/mrdoob">mrdoob</a>? <span id="answer" /></h1>

	<textarea id="code" placeholder="paste code here"></textarea>
	<textarea id="result" class="hide"></textarea>

	<div id="loading">Loading</div>

	<script src="jscs-browser.js"></script>

	<button onclick="check()">Check</button>
	Auto-check <input type="checkbox" id="autocheck" checked />
 
	<button onclick="format()">Format</button>
	<span id="hints" class="no"></span>

	<pre>Protip 1: check the console</pre>

	<pre>Protip 2: To learn more about Mr.doob's Code Styleâ„¢, check out the <a href="https://github.com/mrdoob/three.js/wiki/Mr.doob's-Code-Style%E2%84%A2">wiki</a>, <a href="https://github.com/mrdoob/three.js/issues/4802">discussion</a> and <a href="https://twitter.com/mrdoob/status/463709502853103617">history</a>.</pre>

	<pre>About: another random idea started by <a href="https://twitter.com/blurspline">@blurspline</a> with great contributions by <a href="https://github.com/gero3">gero3</a>.</pre>

	<script>

		var checker = new JscsStringChecker();

		checker.registerDefaultRules();
		checker.configure({
			preset: 'mdcs'
		});

		var loading = document.getElementById('loading');
		loading.style.display = 'none';

		var textarea = document.getElementById('code');
		var result = document.getElementById('result');
		var answer = document.getElementById('answer');
		var hints = document.getElementById('hints');
		var autocheck = document.getElementById('autocheck');


		function init() {

			textarea.addEventListener('change', scheduleCheck);
			textarea.addEventListener('keyup', scheduleCheck);

		}

		init();

		var scheduledCheck;
		function scheduleCheck() {
			if (!autocheck.checked) return;

			if (scheduledCheck) clearTimeout(scheduledCheck);
			scheduledCheck = setTimeout(check, 200);
		}

		function hideAnswer() {
			answer.style.opacity = 0;
		}

		function setAnswer(comment, style) {
			answer.style.opacity = 1;
			answer.textContent = comment;
			answer.className = style;

			setTimeout(hideAnswer, 3000);
		}

		function check() {

			var code = textarea.value;
			// console.info('checking ' + code + '...');

			if (code.trim().length === 0) {
				setAnswer('Maybe... :)', 'maybe');
				return;
			}

			var errors;
			try {
				console.time('check');
				errors = checker.checkString(code + '\n');
				console.timeEnd('check');
			} catch (e) {
				
				// jscs now catches parse error into errorlist, so this shouldn't happen
				setAnswer('oops... something went wrong...', 'no');
				throw(e);
			}

			var errorList = errors.getErrorList();

			console.log( 'checking done. ' + errorList.length + ' errors' );

			if (errorList.length === 0) {
				setAnswer('Possibly \\o/*\\o', 'yes');
			} else {
				setAnswer('No!!! :(', 'no');
			}

			var error = errorList[ 0 ];

			if (error) {

				hints.textContent = error.line + ':' + error.column + '\t' + error.message + ' (Rule: ' + error.rule + ')';

			} else {

				hints.textContent = '';

			}

			errorList.forEach(function(error) {

				console.warn(errors.explainError(error));

			});

		}
		
		function format() {

			var code = textarea.value;

			var errors;
			try {
				result.value = checker.formatString(code + '\n');
			} catch (e) {
				throw(e);
			}

			result.className = '';

		}
	</script>

	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-7549263-1']);
		_gaq.push(['_trackPageview']);

		(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>

</body>
</html>